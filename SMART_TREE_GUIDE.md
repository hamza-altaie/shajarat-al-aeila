# ูุธุงู ุดุฌุฑุฉ ุงููุจููุฉ ุงูููุญุฏุฉ ุงูุฐููุฉ
## Smart Unified Tribe Tree System

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงููุธุงู ูููุฑ ุฅุฏุงุฑุฉ ุงุญุชุฑุงููุฉ ูุฐููุฉ ูุดุฌุฑุฉ ุงููุจููุฉ ุงูููุญุฏุฉุ ุญูุซ ูููู ููู ุดุฎุต ุฅุถุงูุฉ ููุณู ูุฃููุงุฏู ููุชู ุงูุฑุจุท ุชููุงุฆูุงู ูุจูุงุก ุดุฌุฑุฉ ูุฑููุฉ ููุญุฏุฉ.

### โจ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

1. **ุงูุฑุจุท ุงูุชููุงุฆู ุงูุฐูู**
   - ุนูุฏ ุฅุถุงูุฉ ุดุฎุต ุฌุฏูุฏุ ูุจุญุซ ุงููุธุงู ุชููุงุฆูุงู ุนู ูุงูุฏ ูุญุชูู ุจูุงุกู ุนูู ุงุณู ุงูุฃุจ ูุงุณู ุงูุฌุฏ
   - ูุชู ุงูุฑุจุท ุชููุงุฆูุงู ุฅุฐุง ูุงูุช ูุณุจุฉ ุงูุชุทุงุจู ุนุงููุฉ (โฅ70%)
   - ููุถุงู ููุทุงุจูุฉ ูุนููุฉ ูููุฑุงุฌุนุฉ ุฅุฐุง ูุงูุช ุงููุณุจุฉ ูุชูุณุทุฉ (50-70%)

2. **ููุน ุงูุชูุฑุงุฑ**
   - ูุจู ุฅุถุงูุฉ ุฃู ุดุฎุตุ ูุชุญูู ุงููุธุงู ูู ุนุฏู ูุฌูุฏ ุดุฎุต ูุดุงุจู
   - ูุชู ุญุณุงุจ ุฏุฑุฌุฉ ุงูุชุดุงุจู ุจูุงุกู ุนูู: ุงูุงุณู ุงูุฃููุ ุงุณู ุงูุฃุจุ ุงุณู ุงูุฌุฏุ ุงุณู ุงูุนุงุฆูุฉ
   - ุชุญุฐูุฑ ุงููุณุชุฎุฏู ุฅุฐุง ููุฌุฏ ุชุทุงุจู ุฏููู

3. **ุงูุดุฌุฑุฉ ุงููุฑููุฉ ุงูููุญุฏุฉ**
   - ุชุจุฏุฃ ูู ุงูุฌุฐูุฑ (ุงูุฃุดุฎุงุต ุจุฏูู ุขุจุงุก ูุณุฌููู)
   - ุชูุชุฏ ูุฑููุงู ููุฃุฌูุงู ุงูุชุงููุฉ
   - ุนุฑุถ ุชูุงุนูู ูุน D3.js ูุฎูุงุฑุงุช ุชูุจูุฑ/ุชุตุบูุฑ

4. **ุฅุฏุงุฑุฉ ุงููุทุงุจูุงุช ุงููุนููุฉ**
   - ุตูุญุฉ ุฎุงุตุฉ ููุฑุงุฌุนุฉ ุงูุชุฑุงุญุงุช ุงูุฑุจุท
   - ูุจูู ุฃู ุฑูุถ ูู ูุทุงุจูุฉ
   - ุนุฑุถ ุฃุณุจุงุจ ุงูุชุทุงุจู ูุฏุฑุฌุฉ ุงูุซูุฉ

---

## ๐ ูููู ุงููููุงุช ุงูุฌุฏูุฏุฉ

```
src/
โโโ services/
โ   โโโ tribeService.js         # (ูุญุฏูุซ) - ุฅุถุงูุฉ ุฏูุงู ุงูุฑุจุท ุงูุฐูู
โ   โโโ smartLinkingService.js  # (ุฌุฏูุฏ) - ุฎูุงุฑุฒููุงุช ุงูุฑุจุท ุงููุชูุฏูุฉ
โโโ components/
โ   โโโ UnifiedTribeTree.jsx    # (ุฌุฏูุฏ) - ูููู ุงูุดุฌุฑุฉ ุงููุฑููุฉ ุงูููุญุฏุฉ
โ   โโโ UnifiedTribeTree.css    # (ุฌุฏูุฏ) - ุฃููุงุท ุงูุดุฌุฑุฉ
โโโ pages/
โ   โโโ AddPerson.jsx           # (ุฌุฏูุฏ) - ุตูุญุฉ ุฅุถุงูุฉ ุดุฎุต ุจุงูุฑุจุท ุงูุฐูู
โ   โโโ PendingMatches.jsx      # (ุฌุฏูุฏ) - ุตูุญุฉ ุงููุทุงุจูุงุช ุงููุนููุฉ
โ   โโโ FamilyTree.jsx          # (ูุญุฏูุซ) - ุฅุถุงูุฉ ุชุจุฏูู ุจูู ุงูุนุฑุถูู
โโโ AppRoutes.jsx               # (ูุญุฏูุซ) - ุฅุถุงูุฉ ุงููุณุงุฑุงุช ุงูุฌุฏูุฏุฉ

supabase-smart-tribe-schema.sql # (ุฌุฏูุฏ) - ุชุญุฏูุซุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

---

## ๐๏ธ ุชุญุฏูุซุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ

1. **pending_links** - ุทูุจุงุช ุงูุฑุจุท ุงููุนููุฉ
2. **potential_matches** - ุงููุทุงุจูุงุช ุงููุญุชููุฉ ููุฏูุฌ
3. **lineage_chains** - ุณูุงุณู ุงููุณุจ ููุจุญุซ ุงูุณุฑูุน
4. **tree_roots** - ุฌุฐูุฑ ุงูุดุฌุฑุฉ (ุงูุฃุฌุฏุงุฏ ุงูุฃุนูู)

### ุงูุฃุนูุฏุฉ ุงูุฌุฏูุฏุฉ ูู persons

- `ancestor_chain` - ุณูุณูุฉ ุงููุณุจ ููุตูููุฉ
- `full_lineage` - ุงููุณุจ ุงููุงูู ููุต
- `verified` - ูู ุชู ุงูุชุญูู ูู ุงูุดุฎุต
- `auto_linked` - ูู ุชู ุงูุฑุจุท ุชููุงุฆูุงู
- `confidence_score` - ุฏุฑุฌุฉ ุงูุซูุฉ ูู ุงูุฑุจุท
- `link_source` - ูุตุฏุฑ ุงูุฑุจุท (manual/auto_name/auto_parent)

### ุงูุฏูุงู ุงูุฌุฏูุฏุฉ (PostgreSQL)

- `calculate_ancestor_chain()` - ุญุณุงุจ ุณูุณูุฉ ุงููุณุจ
- `build_full_lineage()` - ุจูุงุก ุงููุณุจ ุงููุงูู
- `calculate_match_score()` - ุญุณุงุจ ุฏุฑุฌุฉ ุงูุชุทุงุจู
- `find_potential_matches()` - ุงูุจุญุซ ุนู ูุทุงุจูุงุช ูุญุชููุฉ
- `auto_link_person()` - ุงูุฑุจุท ุงูุชููุงุฆู ููุฃุดุฎุงุต ุงูุฌุฏุฏ
- `check_duplicate_person()` - ุงูุชุญูู ูู ุงูุชูุฑุงุฑ
- `rebuild_tree_roots()` - ุฅุนุงุฏุฉ ุจูุงุก ุฌุฐูุฑ ุงูุดุฌุฑุฉ
- `get_tribe_tree_json()` - ุงูุญุตูู ุนูู ุงูุดุฌุฑุฉ ูู JSON

---

## ๐ ุงููุณุงุฑุงุช (Routes)

| ุงููุณุงุฑ | ุงูุตูุญุฉ | ุงููุตู |
|--------|--------|-------|
| `/family` | Family.jsx | ุฅุฏุงุฑุฉ ุงูุฃูุฑุงุฏ |
| `/tree` | FamilyTree.jsx | ุนุฑุถ ุงูุดุฌุฑุฉ |
| `/add-person` | AddPerson.jsx | ุฅุถุงูุฉ ุดุฎุต ุจุงูุฑุจุท ุงูุฐูู |
| `/pending-matches` | PendingMatches.jsx | ูุฑุงุฌุนุฉ ุงููุทุงุจูุงุช |
| `/statistics` | Statistics.jsx | ุงูุฅุญุตุงุฆูุงุช |

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช

```bash
# ุชุดุบูู ููู ุงูุชุญุฏูุซุงุช ุนูู Supabase
psql -f supabase-smart-tribe-schema.sql
```

### 2. ุฅุถุงูุฉ ุดุฎุต ุฌุฏูุฏ

1. ุงูุชูู ุฅูู `/add-person` ุฃู ุงุถุบุท "ุฅุถุงูุฉ ุฐููุฉ" ูู ุตูุญุฉ ุงูุฃูุฑุงุฏ
2. ุงุฎุชุฑ ุตูุฉ ุงููุฑุงุจุฉ (ุฃูุงุ ุงุจููุ ุฃุฎูุ ูุงูุฏูุ ุฅูุฎ)
3. ุฃุฏุฎู ุงูุงุณู ุงูุฃูู ูุงุณู ุงูุฃุจ (ูุงุณู ุงูุฌุฏ ุงุฎุชูุงุฑูุงู)
4. ุณูุจุญุซ ุงููุธุงู ุชููุงุฆูุงู ุนู:
   - ุฃุดุฎุงุต ูุดุงุจููู (ูููุน ุงูุชูุฑุงุฑ)
   - ูุงูุฏ ูุญุชูู (ููุฑุจุท ุงูุชููุงุฆู)
5. ุฃููู ุงูุจูุงูุงุช ูุงุถุบุท "ุชุฃููุฏ ุงูุฅุถุงูุฉ"

### 3. ูุฑุงุฌุนุฉ ุงููุทุงุจูุงุช

1. ุงูุชูู ุฅูู `/pending-matches`
2. ุณุชุธูุฑ ูุงุฆูุฉ ุจุงููุทุงุจูุงุช ุงููุนููุฉ
3. ููู ูุทุงุจูุฉุ ููููู:
   - **ูุจูู**: ุฅูุดุงุก ุงูุนูุงูุฉ ูู ุงูุดุฌุฑุฉ
   - **ุฑูุถ**: ุชุฌุงูู ุงูุงูุชุฑุงุญ

### 4. ุนุฑุถ ุงูุดุฌุฑุฉ

1. ุงูุชูู ุฅูู `/tree`
2. ุงุฎุชุฑ ุจูู:
   - **ุงูุดุฌุฑุฉ ุงูููุญุฏุฉ**: ุนุฑุถ ูุฑูู ูู ุงูุฌุฐูุฑ
   - **ุงูุนุฑุถ ุงููุชูุฏู**: ุงูุนุฑุถ ุงูุณุงุจู

---

## ๐ง ุฎูุงุฑุฒููุฉ ุงูุฑุจุท ุงูุฐูู

```
ุนูุฏ ุฅุถุงูุฉ ุดุฎุต ุฌุฏูุฏ:
1. ุงูุชุญูู ูู ุงูุชูุฑุงุฑ
   โโ ุฅุฐุง ููุฌุฏ ุชุทุงุจู ุฏููู โ ุชุญุฐูุฑ ุงููุณุชุฎุฏู
   โโ ุฅุฐุง ููุฌุฏ ุชุดุงุจู ุฌุฒุฆู โ ุนุฑุถ ุงูุฃุดุฎุงุต ุงููุดุงุจููู

2. ุงูุจุญุซ ุนู ูุงูุฏ ูุญุชูู
   โโ ุงูุจุญุซ ุจู first_name = father_name ููุดุฎุต ุงูุฌุฏูุฏ
   โโ ุชุถููู ุงููุชุงุฆุฌ ุจู father_name = grandfather_name (ุฅุฐุง ูุชููุฑ)

3. ุญุณุงุจ ุฏุฑุฌุฉ ุงูุซูุฉ
   โโ ุชุทุงุจู ุงูุงุณู ุงูุฃูู = 40 ููุทุฉ
   โโ ุชุทุงุจู ุงุณู ุงูุฃุจ = 30 ููุทุฉ
   โโ ุชุทุงุจู ุงุณู ุงูุฌุฏ = 20 ููุทุฉ
   โโ ุชุทุงุจู ุงุณู ุงูุนุงุฆูุฉ = 10 ููุทุฉ

4. ุงุชุฎุงุฐ ุงููุฑุงุฑ
   โโ ุฅุฐุง ุงูุซูุฉ โฅ 70% โ ุฑุจุท ุชููุงุฆู ูุจุงุดุฑ
   โโ ุฅุฐุง ุงูุซูุฉ 50-70% โ ุฅุถุงูุฉ ูููุทุงุจูุงุช ุงููุนููุฉ
   โโ ุฅุฐุง ุงูุซูุฉ < 50% โ ูุง ุฑุจุท
```

---

## ๐ ูุงุฌูุงุช API ุงูุฌุฏูุฏุฉ

### tribeService.js

```javascript
// ุฅูุดุงุก ุดุฎุต ูุน ุงูุฑุจุท ุงูุฐูู
createSmartPerson(tribeId, personData)
// ููุฑุฌุน: { success, person, linkResult, similarPersons }

// ุจูุงุก ุงูุดุฌุฑุฉ ุงููุฑููุฉ
buildUnifiedTree(tribeId)
// ููุฑุฌุน: { roots, allPersons, relations, stats }

// ุงูุชุญูู ูู ุงูุชูุฑุงุฑ
checkDuplicatePerson(tribeId, firstName, fatherName, grandfatherName)
// ููุฑุฌุน: [{ id, matchScore, isExactMatch }]

// ุงูุจุญุซ ุนู ูุงูุฏ ูุญุชูู
findPotentialParent(tribeId, fatherName, grandfatherName)
// ููุฑุฌุน: [{ id, first_name, father_name, ... }]

// ุงูุญุตูู ุนูู ูุณุจ ุดุฎุต
getPersonLineage(tribeId, personId)
// ููุฑุฌุน: [{ id, firstName, fatherName, fullName }]

// ุฏูุฌ ุดุฎุตูู
mergePersons(tribeId, keepPersonId, removePersonId)
// ููุฑุฌุน: true/false

// ุฅุญุตุงุฆูุงุช ุงูุดุฌุฑุฉ
getTribeStatistics(tribeId)
// ููุฑุฌุน: { totalPersons, maleCount, femaleCount, ... }
```

---

## ๐จ ููููุงุช ุงููุงุฌูุฉ

### UnifiedTribeTree

```jsx
<UnifiedTribeTree />
```

**ุงูููุฒุงุช:**
- ุนุฑุถ ูุฑูู ุชูุงุนูู ุจู D3.js
- ุชูุจูุฑ/ุชุตุบูุฑ/ุชูุณูุท
- ุจุญุซ ูู ุงูุดุฌุฑุฉ
- ุชูููุฒ ูุชุงุฆุฌ ุงูุจุญุซ
- ุนุฑุถ ุชูุงุตูู ุงูุดุฎุต ุนูุฏ ุงูููุฑ
- ุชุญููู ุงูุดุฌุฑุฉ ูุตูุฑุฉ SVG
- ุฏุนู ููุก ุงูุดุงุดุฉ

### AddPerson

```jsx
<AddPerson />
```

**ุงูููุฒุงุช:**
- ูููุฐุฌ ูุชุนุฏุฏ ุงูุฎุทูุงุช
- ุชุญูู ููุฑู ูู ุงูุชูุฑุงุฑ
- ุงูุชุฑุงุญ ุงูุฑุจุท ุงูุชููุงุฆู
- ูุนุงููุฉ ุงูุจูุงูุงุช ูุจู ุงูุญูุธ

---

## ๐ ุงูุฃูุงู

- ุฌููุน ุงูุนูููุงุช ุชุชุทูุจ ูุตุงุฏูุฉ Firebase
- ุงูุชุญูู ูู ุงูุนุถููุฉ ูู ุงููุจููุฉ ูุจู ุฃู ุนูููุฉ
- ุณุฌู ุชุฏููู ูุฌููุน ุงูุชุนุฏููุงุช (person_audit_log)
- ููุน ุงูุฏูุฑุงุช ูู ุงูุดุฌุฑุฉ (ุงูุงุจู ูุง ูููู ุฃู ูููู ุฌุฏุงู ููุฃุจ)

---

## ๐ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

ุงููุธุงู ูุชุนุงูู ูุน ุงูุณููุงุฑูููุงุช ุงูุชุงููุฉ:
- ูุญุงููุฉ ุฅุถุงูุฉ ุดุฎุต ููุฑุฑ
- ูุญุงููุฉ ุฅูุดุงุก ุฏูุฑุฉ ูู ุงูุดุฌุฑุฉ
- ุนุฏู ูุฌูุฏ ุตูุงุญูุงุช
- ูุดู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## ๐ ููุงุญุธุงุช ุงูุชุทููุฑ

1. **ุงูุฃุฏุงุก**: ุงูุดุฌุฑุฉ ููุญุณููุฉ ูุนุฑุถ ุขูุงู ุงูุฃุดุฎุงุต
2. **ุงูุชูุงูู**: ูุนูู ุนูู ุฌููุน ุงููุชุตูุญุงุช ุงูุญุฏูุซุฉ
3. **ุงูุงุณุชุฌุงุจุฉ**: ุชุตููู ูุชุฌุงูุจ ููููุงุชู ูุงูุฃุฌูุฒุฉ ุงูููุญูุฉ
4. **RTL**: ุฏุนู ูุงูู ููุบุฉ ุงูุนุฑุจูุฉ ูุงูุงุชุฌุงู ูู ุงููููู ูููุณุงุฑ

---

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ ุงูููุชุฑุญุฉ

- [ ] ุชุตุฏูุฑ ุงูุดุฌุฑุฉ ูู PDF
- [ ] ูุดุงุฑูุฉ ุฑุงุจุท ููุฑุน ูุนูู
- [ ] ุฅุดุนุงุฑุงุช ุนูุฏ ุฅุถุงูุฉ ูุฑูุจ ุฌุฏูุฏ
- [ ] ุชูุงูู ูุน ุชุทุจูู ุงููุงุชู
- [ ] ุงูุจุญุซ ุงูุตูุชู

---

**ุขุฎุฑ ุชุญุฏูุซ:** ููุงูุฑ 2026
