# توحيد خطوط الربط في شجرة العائلة

## المشكلة
كانت خطوط الربط بين الكارتات في شجرة العائلة غير موحدة، حيث كانت تستخدم ألوان وأسماك وأنماط مختلفة حسب نوع العلاقة بطريقة عشوائية.

## الحل المطبق

### 1. نظام موحد لأنماط الخطوط
تم إنشاء نظام `CONNECTION_STYLES` الذي يحدد أنماطاً موحدة لجميع أنواع العلاقات:

```javascript
const CONNECTION_STYLES = {
  // الخطوط الأساسية (الوالد - الطفل)
  primary: {
    stroke: "#6366f1",      // أزرق بنفسجي
    strokeWidth: 3,
    opacity: 0.8,
    isDashed: false
  },
  // خطوط الأشقاء
  sibling: {
    stroke: "#8b5cf6",      // بنفسجي
    strokeWidth: 2.5,
    opacity: 0.75,
    isDashed: false
  },
  // خطوط الأقارب (أعمام، أولاد أشقاء)
  relative: {
    stroke: "#06b6d4",      // سماوي
    strokeWidth: 2,
    opacity: 0.65,
    isDashed: true
  },
  // خطوط الأزواج
  spouse: {
    stroke: "#10b981",      // أخضر
    strokeWidth: 2.5,
    opacity: 0.7,
    isDashed: false
  },
  // خطوط ثانوية (خطوط أفقية مساعدة)
  secondary: {
    stroke: "#64748b",      // رمادي
    strokeWidth: 2,
    opacity: 0.6,
    isDashed: false
  }
};
```

### 2. دالة موحدة للرسم
تم استبدال الدالة القديمة `drawCurvedLine` بدالة موحدة جديدة `drawUnifiedLine` التي تتضمن:

- **أنماط محددة مسبقاً**: استخدام `CONNECTION_STYLES` بدلاً من تمرير المعاملات يدوياً
- **انحناءات موحدة**: نصف قطر ثابت (20px) لجميع الانحناءات
- **تأثيرات تفاعلية**: تكبير وإضاءة عند التحويم
- **ظلال موحدة**: نفس تأثير الظل لجميع الخطوط
- **أنيميشن متسق**: نفس مدة وطريقة الحركة

### 3. تحسينات CSS
تم إضافة فئات CSS موحدة:

```css
.unified-connection-line {
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
  transition: all 0.3s cubic-bezier(0.23, 1, 0.320, 1);
  cursor: pointer;
}
```

مع تأثيرات خاصة لكل نوع علاقة:
- **خطوط الوالد-الطفل**: ظلال زرقاء
- **خطوط الأقارب**: خطوط متقطعة متحركة
- **خطوط الأزواج**: ظلال خضراء

### 4. التحديثات المطبقة

#### تم استبدال جميع استخدامات `drawCurvedLine` القديمة:
- خطوط الأشقاء والوالدين
- خطوط الأعمام والعمات  
- خطوط الأخوال والخالات
- خطوط أولاد الأشقاء
- خطوط الأزواج
- خطوط الشجرة الأساسية

#### تم توحيد:
- **الألوان**: نظام ألوان متسق حسب نوع العلاقة
- **السُمك**: أسماك محددة حسب أهمية العلاقة
- **الشفافية**: مستويات شفافية متدرجة
- **الانحناءات**: نصف قطر موحد لجميع الانحناءات
- **التأثيرات**: ظلال وتأثيرات تفاعلية موحدة

### 5. المزايا الجديدة

1. **رؤية أوضح**: ألوان مميزة لكل نوع علاقة
2. **تفاعل أفضل**: تأثيرات التحويم والتكبير
3. **أداء محسّن**: كود أقل تعقيداً وأكثر كفاءة
4. **سهولة الصيانة**: نظام موحد لجميع الخطوط
5. **تناسق بصري**: نفس النمط في كامل التطبيق

### 6. دعم المستقبل
النظام الجديد يدعم إضافة أنواع جديدة من العلاقات بسهولة عبر إضافة نمط جديد في `CONNECTION_STYLES` دون الحاجة لتعديل كامل الكود.

## النتيجة
الآن جميع خطوط الربط في شجرة العائلة موحدة ومتسقة، مع تمييز واضح لكل نوع علاقة وتفاعل أفضل مع المستخدم.
